@model List<Idea>

@{
    Layout = "_QAM";
    <link rel="stylesheet" href="~/css/res_qa_idea.css" />
    ViewData["Title"] = "List Idea";
    var count = 0;
}
@if (User.Identity.IsAuthenticated && User.IsInRole("Quality Assurance Manager"))
{
    <div class="idea">
        @{
            int next = int.Parse(@ViewBag.PageNum.ToString()) + 1;
            int pre = int.Parse(@ViewBag.PageNum.ToString()) - 1;
            var viewType = @ViewBag.ViewType;
        }
        <div class="paginations" style=" border-radius: 3em">
            @if (pre > 0)
            {
                <div class="prev">
                    <span class="text" onclick="BtnPre()">Prev</span>
                    <div class="left">
                    </div>
                </div>
            }
            @if (next * 25 - ViewBag.Total < 25)
            {
                <div class="next">
                    <span class="text" id="BtnNext" onclick="BtnNext()">Next</span>
                    <div class="right">
                    </div>
                </div>
            }
        </div>

        <div class="dropdown">
            <button class="btn_dropdown dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fa-solid fa-filter"></i>
            </button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" asp-controller="QAManager" asp-action="Idea" asp-route-pageNum="1" asp-route-viewType="popular">Most Popular Ideas</a>
                <a class="dropdown-item" asp-controller="QAManager" asp-action="Idea" asp-route-pageNum="1" asp-route-viewType="mostview">Most Viewed Ideas</a>
                <a class="dropdown-item" asp-controller="QAManager" asp-action="Idea" asp-route-pageNum="1" asp-route-viewType="latest">Latest Ideas</a>
            </div>
        </div>

        <div class="download_doc">
            <a asp-controller="QAManager" asp-action="DownloadFile">
                <button class="download-button">
                    <div class="docs"><svg class="css-i6dzq1" stroke-linejoin="round" stroke-linecap="round" fill="none" stroke-width="2" stroke="currentColor" height="20" width="20" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line y2="13" x2="8" y1="13" x1="16"></line><line y2="17" x2="8" y1="17" x1="16"></line><polyline points="10 9 9 9 8 9"></polyline></svg> Zip</div>
                    <div class="download">
                        <svg class="css-i6dzq1" stroke-linejoin="round" stroke-linecap="round" fill="none" stroke-width="2" stroke="currentColor" height="24" width="24" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line y2="3" x2="12" y1="15" x1="12"></line></svg>
                    </div>
                </button>
            </a>
        </div>


        <div class="download_csv">
            <a asp-controller="QAManager" asp-action="DownloadCSV">
                <button class="download-button">
                    <div class="docs"><svg class="css-i6dzq1" stroke-linejoin="round" stroke-linecap="round" fill="none" stroke-width="2" stroke="currentColor" height="20" width="20" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line y2="13" x2="8" y1="13" x1="16"></line><line y2="17" x2="8" y1="17" x1="16"></line><polyline points="10 9 9 9 8 9"></polyline></svg> CSV</div>
                    <div class="download">
                        <svg class="css-i6dzq1" stroke-linejoin="round" stroke-linecap="round" fill="none" stroke-width="2" stroke="currentColor" height="24" width="24" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line y2="3" x2="12" y1="15" x1="12"></line></svg>
                    </div>
                </button>
            </a>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th scope="col">No.</th>
                    <th scope="col">Title</th>
                    <th class="content_table" scope="col">Content</th>
                    <th scope="col">Date</th>
                    <th scope="col">First Closure</th>
                    <th scope="col">Last Closure</th>
                    <th scope="col">Anonymous</th>
                    <th scope="col">View</th>
                    <th scope="col">Name</th>
                    <th scope="col">Category </th>
                    <th scope="col">Thumbs Up</th>
                    <th scope="col">Thumbs Down</th>
                    <th scope="col">Document</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var i in Model)
                {
                    <tr>
                        <td>@i.IdeaId</td>
                        <td>@i.idea_title</td>
                        <td>@i.idea_content</td>
                        <td>@i.created_date</td>
                        <td>@i.Event.First_closure_date</td>
                        <td>@i.Event.Last_closure_date</td>
                        @if (i.idea_anonymous == true)
                        {
                            <td>Yes</td>
                        }
                        else
                        {
                            <td>No</td>
                        }
                        <td>@i.idea_view</td>
                        <td>@i.Profile.Name</td>
                        <td>@i.Category.category_name</td>
                        <td>@i.Reacpoint.ThumbUp</td>
                        <td>@i.Reacpoint.ThumbDown</td>
                        @foreach (var d in ViewBag.Documents)
                        {
                            if (d.IdeaId == i.IdeaId)
                            {
                                 count++; 
                            }
                            else
                            {
                                count = 0;
                            }
                        }
                        @if (count == 0)
                        {
                            <td>None</td>
                        }else{
                            <td><a asp-action="DownloadEachFile" asp-controller="QAManager" asp-route-id="@i.IdeaId">@count documents</a></td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <script>
        function BtnNext() {
            window.location.replace('/QAManager/Idea?pageNum=@next&viewType=@viewType');
        }
        function BtnPre() {
            window.location.replace('/QAManager/Idea?pageNum=@pre&viewType=@viewType');
        }
    </script>
}
